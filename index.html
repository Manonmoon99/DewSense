<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>露水與作物病害提醒 | 多農場版</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(to bottom, #0f2027, #203a43, #2c5364);
            color: #e2e8f0;
            min-height: 100vh;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        .highlight-badge {
            box-shadow: 0 0 15px rgba(34, 211, 238, 0.3);
        }
        /* 滾動條美化 */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }
        
        /* Modal 動畫 */
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out forwards;
        }
        /* 可點擊元素的游標樣式 */
        .clickable-badge {
            cursor: pointer;
            transition: transform 0.2s;
        }
        .clickable-badge:active {
            transform: scale(0.95);
        }
        /* 葉子旋轉動畫 (載入時) */
        @keyframes leafSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .animate-leaf-spin {
            animation: leafSpin 2s infinite linear;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 預設農場資料 ---
        const DEFAULT_FARM = {
            name: "心是一畝田自然農場",
            lat: 22.6980,
            lon: 120.3480
        };

        // --- 設定視窗組件 ---
        const SettingsModal = ({ isOpen, onClose, currentSettings, onSave, onReset }) => {
            const [formData, setFormData] = useState(currentSettings);

            useEffect(() => {
                if (isOpen) setFormData(currentSettings);
            }, [isOpen, currentSettings]);

            if (!isOpen) return null;

            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave({
                    name: formData.name,
                    lat: parseFloat(formData.lat),
                    lon: parseFloat(formData.lon)
                });
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div className="absolute inset-0 bg-slate-900/90 backdrop-blur-sm transition-opacity" onClick={onClose}></div>
                    <div className="relative bg-slate-800 border border-slate-600 rounded-2xl w-full max-w-md shadow-2xl animate-fadeIn overflow-hidden">
                        <div className="flex justify-between items-center p-4 border-b border-slate-700 bg-slate-900/50">
                            <h3 className="text-xl font-bold text-white">
                                <i className="fas fa-cog mr-2 text-slate-400"></i>農場位置設定
                            </h3>
                            <button onClick={onClose} className="w-8 h-8 rounded-full bg-slate-700 text-slate-300 hover:bg-slate-600 hover:text-white flex items-center justify-center transition-colors">
                                <i className="fas fa-times"></i>
                            </button>
                        </div>
                        <form onSubmit={handleSubmit} className="p-6 space-y-4">
                            <div>
                                <label className="block text-xs text-slate-400 mb-1">農場名稱</label>
                                <input type="text" name="name" value={formData.name} onChange={handleChange} className="w-full bg-slate-900/50 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-green-500" required />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-xs text-slate-400 mb-1">緯度 (Lat)</label>
                                    <input type="number" step="0.0001" name="lat" value={formData.lat} onChange={handleChange} className="w-full bg-slate-900/50 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-green-500 font-mono" required />
                                </div>
                                <div>
                                    <label className="block text-xs text-slate-400 mb-1">經度 (Lon)</label>
                                    <input type="number" step="0.0001" name="lon" value={formData.lon} onChange={handleChange} className="w-full bg-slate-900/50 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-green-500 font-mono" required />
                                </div>
                            </div>
                            <div className="pt-4 flex gap-3">
                                <button type="button" onClick={() => { onReset(); onClose(); }} className="flex-1 bg-slate-700 hover:bg-slate-600 text-slate-300 py-2 rounded-lg text-sm transition-colors border border-slate-600">還原預設</button>
                                <button type="submit" className="flex-1 bg-green-600 hover:bg-green-500 text-white py-2 rounded-lg text-sm font-bold shadow-lg shadow-green-900/50 transition-colors">儲存設定</button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // --- 持續時間說明視窗組件 ---
        const DurationModal = ({ isOpen, onClose }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div className="absolute inset-0 bg-slate-900/90 backdrop-blur-sm transition-opacity" onClick={onClose}></div>
                    <div className="relative bg-slate-800 border border-slate-600 rounded-2xl w-full max-w-md shadow-2xl flex flex-col animate-fadeIn">
                        <div className="flex justify-between items-center p-4 border-b border-slate-700 bg-slate-900/50">
                            <h3 className="text-lg font-bold text-yellow-300">
                                <i className="fas fa-clock mr-2"></i>葉面濕潤持續時間 (LWD)
                            </h3>
                            <button onClick={onClose} className="w-8 h-8 rounded-full bg-slate-700 text-slate-300 hover:bg-slate-600 hover:text-white flex items-center justify-center transition-colors"><i className="fas fa-times"></i></button>
                        </div>
                        <div className="p-6 space-y-4">
                            <p className="text-sm text-slate-300 leading-relaxed">
                                指標計算從<strong>開始結露</strong>到<strong>隔日 09:00</strong> 的總時數。時間越長，病害風險越高。
                            </p>
                            <div className="space-y-2">
                                <div className="flex items-center gap-3 p-3 rounded-lg bg-green-900/20 border border-green-500/30">
                                    <div className="w-16 text-center font-bold text-green-400">&lt; 5h</div>
                                    <div className="text-xs text-slate-300"><strong className="text-green-300 block mb-1">安全期</strong>濕潤短，太陽出來即乾。</div>
                                </div>
                                <div className="flex items-center gap-3 p-3 rounded-lg bg-yellow-900/20 border border-yellow-500/30">
                                    <div className="w-16 text-center font-bold text-yellow-400">5 - 9h</div>
                                    <div className="text-xs text-slate-300"><strong className="text-yellow-300 block mb-1">警戒期</strong>病菌開始活躍，需觀察。</div>
                                </div>
                                <div className="flex items-center gap-3 p-3 rounded-lg bg-red-900/20 border border-red-500/30">
                                    <div className="w-16 text-center font-bold text-red-400">&gt; 9h</div>
                                    <div className="text-xs text-slate-300"><strong className="text-red-300 block mb-1">危險期</strong>極高風險，建議提前防治。</div>
                                </div>
                            </div>
                        </div>
                        <div className="p-4 border-t border-slate-700 bg-slate-900/50 text-center">
                            <button onClick={onClose} className="bg-slate-700 hover:bg-slate-600 text-white px-6 py-2 rounded-full font-bold transition-all text-sm">關閉</button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 農務知識視窗組件 ---
        const KnowledgeModal = ({ isOpen, onClose }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div className="absolute inset-0 bg-slate-900/90 backdrop-blur-sm transition-opacity" onClick={onClose}></div>
                    <div className="relative bg-slate-800 border border-slate-600 rounded-2xl w-full max-w-lg shadow-2xl flex flex-col max-h-[90vh] animate-fadeIn">
                        <div className="flex justify-between items-center p-4 border-b border-slate-700 bg-slate-900/50">
                            <h3 className="text-xl font-bold text-green-400">
                                <i className="fas fa-leaf mr-2"></i>露水與病蟲害防治
                            </h3>
                            <button onClick={onClose} className="w-8 h-8 rounded-full bg-slate-700 text-slate-300 hover:bg-slate-600 hover:text-white flex items-center justify-center transition-colors"><i className="fas fa-times"></i></button>
                        </div>
                        <div className="p-6 overflow-y-auto space-y-8">
                            <div className="space-y-3">
                                <h4 className="font-bold text-red-300 border-b border-red-500/30 pb-1"><i className="fas fa-exclamation-circle mr-2"></i>為何致病？</h4>
                                <p className="text-sm text-slate-300 leading-relaxed">病菌孢子需要<strong>「葉面游離水」</strong>才能發芽，通常需 4-8 小時持續濕潤。</p>
                            </div>
                            <div className="space-y-4">
                                <h4 className="font-bold text-cyan-300 border-b border-cyan-500/30 pb-1"><i className="fas fa-shield-alt mr-2"></i>如何防治？</h4>
                                <div className="bg-slate-700/30 p-4 rounded-lg border-l-4 border-yellow-500">
                                    <h5 className="font-bold text-yellow-200 text-sm mb-1">1. 利用「起始時間」判斷</h5>
                                    <p className="text-xs text-slate-400">• <strong>20:00 前</strong>結露：高風險。<br/>• <strong>04:00 後</strong>結露：低風險。</p>
                                </div>
                                <div className="bg-slate-700/30 p-4 rounded-lg border-l-4 border-green-500">
                                    <h5 className="font-bold text-green-200 text-sm mb-1">2. 物理防護</h5>
                                    <p className="text-xs text-slate-400">預測重露水時，架設防雨棚或覆蓋不織布，留住地熱。</p>
                                </div>
                                <div className="bg-slate-700/30 p-4 rounded-lg border-l-4 border-blue-500">
                                    <h5 className="font-bold text-blue-200 text-sm mb-1">3. 管理</h5>
                                    <p className="text-xs text-slate-400">• <strong>修剪通風</strong>。<br/>• <strong>避免傍晚噴灌</strong>。</p>
                                </div>
                            </div>
                        </div>
                        <div className="p-4 border-t border-slate-700 bg-slate-900/50 text-center">
                            <button onClick={onClose} className="bg-green-600 hover:bg-green-500 text-white px-8 py-2 rounded-full font-bold transition-all shadow-lg shadow-green-900/50">我記住了</button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 解說指南視窗組件 ---
        const GuideModal = ({ isOpen, onClose }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div className="absolute inset-0 bg-slate-900/90 backdrop-blur-sm transition-opacity" onClick={onClose}></div>
                    <div className="relative bg-slate-800 border border-slate-600 rounded-2xl w-full max-w-lg shadow-2xl flex flex-col max-h-[90vh] animate-fadeIn">
                        <div className="flex justify-between items-center p-4 border-b border-slate-700 bg-slate-900/50">
                            <h3 className="text-xl font-bold text-green-400">
                                <i className="fas fa-book-open mr-2"></i>如何閱讀圖表
                            </h3>
                            <button onClick={onClose} className="w-8 h-8 rounded-full bg-slate-700 text-slate-300 hover:bg-slate-600 hover:text-white flex items-center justify-center transition-colors"><i className="fas fa-times"></i></button>
                        </div>
                        <div className="p-6 overflow-y-auto space-y-8">
                            <div className="space-y-2">
                                <div className="flex items-center gap-3 mb-1">
                                    <div className="flex items-center text-cyan-300 bg-cyan-900/30 px-3 py-1 rounded-full border border-cyan-500/20 highlight-badge">
                                        <i className="fas fa-leaf text-[10px] mr-2"></i>
                                        <span className="text-xs font-bold mr-1">開始於</span>
                                        <span className="text-sm font-mono font-bold">03:00</span>
                                    </div>
                                    <h4 className="font-bold text-slate-200">露水起始點 (Onset)</h4>
                                </div>
                                <p className="text-sm text-slate-400 leading-relaxed pl-2 border-l-2 border-cyan-500/30">
                                    代表氣溫與露點溫度達到「黃金交叉」的時刻。
                                </p>
                            </div>
                            <div className="space-y-2">
                                <div className="flex gap-4 mb-1">
                                    <div className="bg-slate-700/50 px-3 py-2 rounded text-center w-24 border border-slate-600">
                                        <div className="text-[10px] text-slate-400">傍晚</div>
                                        <div className="text-blue-300"><i className="fas fa-tint"></i> 高</div>
                                    </div>
                                     <h4 className="font-bold text-slate-200 self-center">定點機率</h4>
                                </div>
                                <p className="text-sm text-slate-400 leading-relaxed pl-2 border-l-2 border-blue-500/30">
                                    取樣點：<strong>傍晚(17:00)</strong> 與 <strong>明晨(05:00)</strong>。
                                </p>
                            </div>
                            <div className="space-y-2">
                                <h4 className="font-bold text-slate-200">濕潤時間軸</h4>
                                <div className="bg-slate-900/50 p-3 rounded-lg border border-slate-700">
                                    <div className="flex justify-between text-[10px] text-slate-500 mb-1">
                                        <span>16:00</span>
                                        <span className="text-cyan-400 font-bold">03:00 起</span>
                                        <span>09:00</span>
                                    </div>
                                    <div className="h-1.5 bg-slate-700 rounded-full overflow-hidden relative">
                                        <div className="absolute h-full bg-cyan-400 shadow-[0_0_8px_rgba(34,211,238,0.8)]" style={{left: '60%', right: 0}}></div>
                                    </div>
                                </div>
                                <p className="text-sm text-slate-400 leading-relaxed mt-2 pl-2 border-l-2 border-slate-500/30">
                                    從傍晚到<strong>隔日上午 9 點</strong>。
                                </p>
                            </div>
                        </div>
                        <div className="p-4 border-t border-slate-700 bg-slate-900/50 text-center">
                            <button onClick={onClose} className="bg-green-600 hover:bg-green-500 text-white px-8 py-2 rounded-full font-bold transition-all shadow-lg shadow-green-900/50">我瞭解了</button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 主程式 ---
        const DewForecastApp = () => {
            const [weatherData, setWeatherData] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [showGuide, setShowGuide] = useState(false);
            const [showSettings, setShowSettings] = useState(false);
            const [showKnowledge, setShowKnowledge] = useState(false);
            const [showDurationInfo, setShowDurationInfo] = useState(false);
            
            const [farmLocation, setFarmLocation] = useState(() => {
                const saved = localStorage.getItem('dew_forecast_farm');
                return saved ? JSON.parse(saved) : DEFAULT_FARM;
            });

            useEffect(() => {
                getWeatherData(farmLocation.lat, farmLocation.lon);
                localStorage.setItem('dew_forecast_farm', JSON.stringify(farmLocation));
            }, [farmLocation]);

            const handleSaveSettings = (newSettings) => {
                setFarmLocation(newSettings);
                setShowSettings(false);
            };

            const handleResetSettings = () => {
                setFarmLocation(DEFAULT_FARM);
            };

            const getWeatherData = async (lat, lon) => {
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(
                        `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,relative_humidity_2m,dew_point_2m,cloud_cover,wind_speed_10m&timezone=auto&forecast_days=8`
                    );
                    const data = await response.json();
                    analyzeDewProbability(data);
                } catch (err) {
                    setError("獲取氣象數據失敗，請檢查網路連線。");
                } finally {
                    setLoading(false);
                }
            };

            const calculateProbability = (temp, dewPoint, windSpeed, cloudCover) => {
                const spread = temp - dewPoint;
                let spreadScore = 0;
                if (spread <= 0.5) spreadScore = 50; else if (spread <= 2.0) spreadScore = 40; else if (spread <= 3.5) spreadScore = 20; else if (spread <= 5.0) spreadScore = 5;
                let windScore = 0;
                if (windSpeed < 5) windScore = 30; else if (windSpeed < 12) windScore = 15;
                let cloudScore = 0;
                if (cloudCover < 20) cloudScore = 20; else if (cloudCover < 60) cloudScore = 10;
                return Math.min(100, spreadScore + windScore + cloudScore);
            };

            const getStatus = (prob) => {
                if (prob >= 75) return { text: "極高", color: "text-cyan-300", bg: "bg-cyan-500/20", icon: "fa-droplet", highlight: true };
                if (prob >= 50) return { text: "高", color: "text-blue-300", bg: "bg-blue-500/20", icon: "fa-tint", highlight: true };
                if (prob >= 25) return { text: "中", color: "text-blue-200", bg: "bg-slate-500/20", icon: "fa-cloud-meatball", highlight: false };
                return { text: "低", color: "text-gray-400", bg: "bg-transparent", icon: "fa-sun", highlight: false };
            };

            const findOnsetHour = (hourly, startIndex, dateObj) => {
                let currentDayStr = dateObj.toISOString().split('T')[0];
                let searchIndex = -1;
                for(let i=0; i<hourly.time.length; i++) {
                    if (hourly.time[i].startsWith(currentDayStr) && hourly.time[i].includes("T16:00")) {
                        searchIndex = i; break;
                    }
                }
                if (searchIndex === -1) return null;
                for (let i = 0; i < 20; i++) {
                    const idx = searchIndex + i;
                    if (idx >= hourly.time.length) break;
                    const temp = hourly.temperature_2m[idx];
                    const dewPoint = hourly.dew_point_2m[idx];
                    const wind = hourly.wind_speed_10m[idx];
                    const cloud = hourly.cloud_cover[idx];
                    const prob = calculateProbability(temp, dewPoint, wind, cloud);
                    if (prob >= 50 && (temp - dewPoint) < 2.5) {
                        const timeString = hourly.time[idx]; 
                        const time = new Date(timeString);
                        const startHour = time.getHours();
                        let duration = 0;
                        if (startHour >= 16) duration = (24 - startHour) + 9; else duration = 9 - startHour;
                        return { timeStr: `${startHour}:00`, fullTime: time, prob: prob, duration: duration };
                    }
                }
                return null;
            };

            const getDurationStyle = (hours) => {
                if (hours >= 9) return { color: "text-red-300", bg: "bg-red-900/40 border-red-500/30", text: "危險" };
                if (hours >= 5) return { color: "text-yellow-300", bg: "bg-yellow-900/40 border-yellow-500/30", text: "警戒" };
                return { color: "text-green-300", bg: "bg-green-900/40 border-green-500/30", text: "安全" };
            };

            const analyzeDewProbability = (data) => {
                const hourly = data.hourly;
                const dailyAnalysis = [];
                const processedDates = new Set();
                for (let i = 0; i < hourly.time.length; i++) {
                    const timeStr = hourly.time[i];
                    const dateObj = new Date(timeStr);
                    const dateKey = dateObj.toLocaleDateString('zh-TW', { month: 'numeric', day: 'numeric' });
                    if (processedDates.has(dateKey)) continue;
                    if (dailyAnalysis.length >= 7) break;
                    if (dateObj.getHours() === 12) {
                        processedDates.add(dateKey);
                        const eveningIndex = i + 5;
                        let eveningData = null;
                        if (eveningIndex < hourly.time.length) {
                             const prob = calculateProbability(hourly.temperature_2m[eveningIndex], hourly.dew_point_2m[eveningIndex], hourly.wind_speed_10m[eveningIndex], hourly.cloud_cover[eveningIndex]);
                            eveningData = { prob, status: getStatus(prob) };
                        }
                        const morningIndex = i + 17;
                        let morningData = null;
                        if (morningIndex < hourly.time.length) {
                             const prob = calculateProbability(hourly.temperature_2m[morningIndex], hourly.dew_point_2m[morningIndex], hourly.wind_speed_10m[morningIndex], hourly.cloud_cover[morningIndex]);
                            morningData = { prob, status: getStatus(prob) };
                        }
                        const onset = findOnsetHour(hourly, i, dateObj);
                        dailyAnalysis.push({
                            date: dateKey,
                            weekday: dateObj.toLocaleDateString('zh-TW', { weekday: 'short' }),
                            evening: eveningData,
                            morning: morningData,
                            onset: onset
                        });
                    }
                }
                setWeatherData(dailyAnalysis);
            };

            return (
                <div className="max-w-md mx-auto p-4 pt-8 min-h-screen flex flex-col">
                    <header className="mb-8 relative flex flex-col items-center">
                        <button onClick={() => setShowSettings(true)} className="absolute left-0 top-0 w-8 h-8 rounded-full border border-slate-500 text-slate-400 hover:text-white hover:border-white hover:bg-slate-700 transition-all flex items-center justify-center text-sm" title="農場位置設定"><i className="fas fa-cog"></i></button>
                        <div className="absolute right-0 top-0 flex gap-2">
                             <button onClick={() => setShowKnowledge(true)} className="w-8 h-8 rounded-full border border-green-500 text-green-400 hover:text-white hover:border-white hover:bg-green-700 transition-all flex items-center justify-center text-sm" title="病害防治知識"><i className="fas fa-leaf"></i></button>
                            <button onClick={() => setShowGuide(true)} className="w-8 h-8 rounded-full border border-slate-500 text-slate-400 hover:text-white hover:border-white hover:bg-slate-700 transition-all flex items-center justify-center text-sm" title="如何閱讀圖表？"><i className="fas fa-question"></i></button>
                        </div>
                        <div className="flex items-center justify-center gap-2 mb-2 mr-12">
                             <i className="fas fa-seedling leaf-icon text-2xl"></i>
                             <h1 className="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-300 to-cyan-300">露水預測</h1>
                        </div>
                        <p className="text-slate-400 text-xs italic">"房屋因智慧建造...屋內充滿各樣美好" (箴 24:3-4)</p>
                    </header>

                    <GuideModal isOpen={showGuide} onClose={() => setShowGuide(false)} />
                    <SettingsModal isOpen={showSettings} onClose={() => setShowSettings(false)} currentSettings={farmLocation} onSave={handleSaveSettings} onReset={handleResetSettings} />
                    <KnowledgeModal isOpen={showKnowledge} onClose={() => setShowKnowledge(false)} />
                    <DurationModal isOpen={showDurationInfo} onClose={() => setShowDurationInfo(false)} />

                    <div className="glass-panel rounded-2xl p-6 mb-6 text-center transition-all duration-300 flex-grow">
                        {loading && (
                            <div className="py-10">
                                <div className="animate-leaf-spin text-4xl text-green-400 mb-4 inline-block"><i className="fas fa-leaf"></i></div>
                                <p className="text-green-200">正在連結 {farmLocation.name}...</p>
                            </div>
                        )}
                        {error && (
                             <div className="text-red-300 bg-red-900/30 p-4 rounded-lg">
                                <i className="fas fa-exclamation-triangle mr-2"></i>{error}
                                <button onClick={() => getWeatherData(farmLocation.lat, farmLocation.lon)} className="block mx-auto mt-4 text-sm underline">重試</button>
                            </div>
                        )}
                        {weatherData && !loading && (
                            <div className="animate-[fadeIn_0.5s_ease-out]">
                                <div className="mb-6 border-b border-slate-600/50 pb-3 text-left">
                                    <h2 className="text-lg font-bold text-green-400 mb-1 flex items-center gap-2 overflow-x-auto whitespace-nowrap scrollbar-hide">
                                        <i className="fas fa-map-pin shrink-0"></i><span>{farmLocation.name}</span>
                                    </h2>
                                    <div className="flex justify-between items-center text-xs">
                                        <span className="text-slate-400">目前位置 座標</span>
                                        <span className="text-slate-300 font-mono">{farmLocation.lat.toFixed(2)}, {farmLocation.lon.toFixed(2)}</span>
                                    </div>
                                </div>
                                <div className="space-y-4">
                                    {weatherData.map((day, index) => (
                                        <div key={index} className="bg-slate-800/60 rounded-xl p-4 border border-slate-600 hover:border-green-400/50 transition-all relative overflow-hidden">
                                            <div className="flex items-center justify-between mb-3">
                                                <div className="flex items-center">
                                                    <span className="text-lg font-bold text-slate-200 mr-2">{day.weekday}</span>
                                                    <span className="text-xs text-slate-400 bg-slate-700/50 px-2 py-1 rounded">{day.date}</span>
                                                </div>
                                                <div className="flex gap-2">
                                                    {day.onset ? (
                                                        <>
                                                            <div onClick={() => setShowDurationInfo(true)} className={`clickable-badge flex items-center px-2 py-1 rounded border text-[10px] font-bold ${getDurationStyle(day.onset.duration).color} ${getDurationStyle(day.onset.duration).bg}`} title="點擊查看持續時間說明">
                                                                <i className="fas fa-stopwatch mr-1"></i><span>{day.onset.duration}h</span>
                                                            </div>
                                                            <div className="flex items-center text-cyan-300 bg-cyan-900/30 px-2 py-1 rounded border border-cyan-500/20 highlight-badge text-[10px]">
                                                                <i className="fas fa-leaf mr-1"></i><span className="font-mono font-bold">{day.onset.timeStr}</span>
                                                            </div>
                                                        </>
                                                    ) : (<div className="text-xs text-slate-500 bg-slate-800 px-2 py-1 rounded">無明顯露水</div>)}
                                                </div>
                                            </div>
                                            <div className="grid grid-cols-2 gap-4 mt-2">
                                                <div className="text-center p-2 rounded bg-slate-900/30">
                                                    <div className="text-[10px] text-slate-400 mb-1">傍晚 (17:00)</div>
                                                    {day.evening ? (
                                                        <div className={`flex items-center justify-center gap-2 ${day.evening.status.color}`}><i className={`fas ${day.evening.status.icon}`}></i><span className="text-sm font-bold">{day.evening.status.text}</span></div>
                                                    ) : <span className="text-xs text-slate-600">-</span>}
                                                </div>
                                                <div className="text-center p-2 rounded bg-slate-900/30">
                                                    <div className="text-[10px] text-slate-400 mb-1">明晨 (05:00)</div>
                                                    {day.morning ? (
                                                        <div className={`flex items-center justify-center gap-2 ${day.morning.status.color}`}><i className={`fas ${day.morning.status.icon}`}></i><span className="text-sm font-bold">{day.morning.status.text}</span></div>
                                                    ) : <span className="text-xs text-slate-600">-</span>}
                                                </div>
                                            </div>
                                            {day.onset && (
                                                <div className="mt-3 pt-3 border-t border-slate-700/50">
                                                    <div className="flex justify-between text-[10px] text-slate-500 mb-1">
                                                        <span>16:00</span>
                                                        <span className="text-cyan-400 font-bold">{day.onset.timeStr} 起</span>
                                                        <span>09:00</span>
                                                    </div>
                                                    <div className="h-1.5 bg-slate-700 rounded-full overflow-hidden relative">
                                                        {(() => {
                                                            const startHour = parseInt(day.onset.timeStr.split(':')[0]);
                                                            let offset = startHour >= 16 ? startHour - 16 : startHour + 8;
                                                            const percent = (offset / 17) * 100;
                                                            return (<div className="absolute h-full bg-cyan-400 shadow-[0_0_8px_rgba(34,211,238,0.8)]" style={{left: `${percent}%`, right: 0}}></div>)
                                                        })()}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                                <button onClick={() => getWeatherData(farmLocation.lat, farmLocation.lon)} className="mt-6 text-sm text-slate-400 hover:text-white transition-colors"><i className="fas fa-sync-alt mr-1"></i> 更新數據</button>
                            </div>
                        )}
                    </div>
                    
                    {/* 正規頁尾 - 共享軟體風格 */}
                    <footer className="py-6 text-center border-t border-slate-700/50 mt-auto bg-slate-900/30">
                        <div className="text-xs text-slate-400 space-y-2">
                            <p className="font-bold text-slate-300">心是一畝田 · 露水觀測站 v2.0</p>
                            <div className="flex justify-center gap-4 text-[10px] text-slate-500">
                                <span>資料來源: Open-Meteo API</span>
                                <span>開發者: 心是一畝田</span>
                            </div>
                            <p className="text-[10px] text-slate-300 px-8 leading-relaxed">
                                免責聲明：本程式提供的氣象與露水預測數據僅供參考。
                                實際農務操作請務必依據現場微氣候、作物特性及個人經驗自行判斷。
                                開發者不對因使用本資訊而產生的任何損失負責。
                            </p>
                            <p className="text-[10px] text-slate-300 mt-2">&copy; 2025 Heart Farm Shareware. Designed for Nature.</p>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DewForecastApp />);
    </script>
</body>
</html>
